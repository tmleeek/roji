<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     rwd_default
 * @copyright   Copyright (c) 2006-2014 X.commerce, Inc. (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Product view template
 *
 * @see Mage_Catalog_Block_Product_View
 * @see Mage_Review_Block_Product_View
 */
?>
<style>
#trade-product-weight-table .price
{
	color: #464646;
    font-family: minion-pro,Verdana,sans-serif;
    font-size: 12px;
    font-style: italic;
    font-weight: 600;
    letter-spacing: 0.03em;
    line-height: 39px;
    text-align: left;
}
#tea-product-detail-section-1 #product-detail-img-info-container .product-info {
    padding-top: 90px;
    padding-bottom: 90px;
    padding-left: 10px;
    padding-right: 30px;
}
.grouped-items .row{
	padding: 0 !important;
	margin-bottom:5px !important;
}
.grouped-items .italic{
		color:white !important;
}
.grouped-items .col-xs-4{
	padding-left:28px !important;
}
.grouped-items .fa{
	display:none;
}
</style>

<?php $_helper = $this->helper('catalog/output'); ?>
<?php $_product = $this->getProduct(); ?>
<?php
$isGiftcardType = $this->helper('catalogcustomiser')->isGiftcardType($_product);

if ($_product->getShortDescription()):
    $shortDescription = $_helper->productAttribute($_product, nl2br($_product->getDescription()), 'short_description');
endif; 
?>
<?php 
    $subscription_in_the_cart = 0;
    $allskus = array("SGP-ART-1M", "SGP-ART-3M", "SGP-ART-6M", "SGP-ART-12M", "SGP-GUR-1M", "SGP-GUR-3M", "SGP-GUR-6M", "SGP-GUR-12M","INT-ART-1M", "INT-ART-3M", "INT-ART-6M", "INT-ART-12M", "INT-GUR-1M", "INT-GUR-3M", "INT-GUR-6M", "INT-GUR-12M");
    $quote = Mage::getSingleton('checkout/session')->getQuote();
    foreach ($quote->getAllVisibleItems() as $item) {
        $itemsku = $item->getProduct()->getData('sku');        
        if(in_array($itemsku, $allskus)) {
            $subscription_in_the_cart = 1;
        }
    }

    $gift_in_the_cart = 0;
    $giftsku = array("RojiGiftCard");
    foreach ($quote->getAllVisibleItems() as $item) {
        $itemsku = $item->getProduct()->getData('sku');        
        if(in_array($itemsku, $giftsku)) {
            $gift_in_the_cart = 1;
        }   
    }

    $_images = Mage::getModel('catalog/product')->load($_product->getId())->getMediaGalleryImages();

    $is_gift_product = false;
    $cats = $_product->getCategoryIds();
    foreach ($cats as $category_id) {
        $_cat = Mage::getModel('catalog/category')->load($category_id);        
        if($_cat->getName() == 'Gift') {
          $is_gift_product = true;
        }
    } 
?>
<form action="<?php echo $this->getSubmitUrl($_product) ?>" method="post" id="product_addtocart_form"<?php if($_product->getOptions()): ?> enctype="multipart/form-data"<?php endif; ?>>
  <input type="hidden" name="product" value="<?php echo $_product->getId() ?>" />
  <input type="hidden" name="related_product" id="related-products-field" value="" />

<article id="page-product-detail-content-section" class="<?php if($is_gift_product): ?>gift-product-version <?php endif; ?><?php if (!$isGiftcardType) : ?>visible-md visible-lg<?php else: ?>gift-card-version<?php endif; ?>">
    <div class="container-fluid has-breakpoint">
        
      <div class="row">
          <div class="<?php if ($isGiftcardType) : ?>col-md-6<?php else: ?>col-md-4<?php endif; ?>">                
              <!--
                   ____ ___ ____  _____ ____    _    ____
                  / ___|_ _|  _ \| ____| __ )  / \  |  _ \
                  \___ \| || | | |  _| |  _ \ / _ \ | |_) |
                   ___) | || |_| | |___| |_) / ___ \|  _ <
                  |____/___|____/|_____|____/_/   \_\_| \_\

              -->
              <div id="page-product-detail-sidebar" <?php if($isGiftcardType): ?>class="gift-card-version"<?php endif; ?>>
                  
                  <?php if($isGiftcardType): ?>
                    <div class="page-product-detail-giftcard-img gift-card-img">
                      <?php echo $this->getChildHtml('media') ?>
                    </div>
                  <?php else: ?>
                    <div id="page-product-detail-closeup">
                        <?php
                            $closeup_image_exist = false;
                            foreach ($_images as $_image): 
                                if($_image->getLabel()=="closeup"):
                                    $closeup_image_exist = true;
                        ?>
                          <?php if($is_gift_product): ?>
                            <div class="manic-image-container has-show-all">
                                <img src="" data-image-desktop="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->constrainOnly(false)->keepAspectRatio(true)->keepFrame(false); ?>" alt="<?php echo $this->htmlEscape($_image->getLabel()) ?>" title="<?php echo $this->htmlEscape($_image->getLabel()) ?>" class="real"/>
                            </div>
                          <?php else: ?>
                            <div class="manic-image-container">
                                <img src="" data-image-desktop="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->constrainOnly(false)->keepAspectRatio(true)->keepFrame(false)->resize(830, null); ?>" alt="<?php echo $this->htmlEscape($_image->getLabel()) ?>" title="<?php echo $this->htmlEscape($_image->getLabel()) ?>" class="real"/>
                            </div>
                          <?php endif; ?>
                        <?php   endif;
                            endforeach;
                        ?>
                        <?php if(!$closeup_image_exist): // temporary ?>                                    
                          <div class="manic-image-container">
                              <img src="" data-image-desktop="<?php echo $this->getSkinUrl('images_cms/product-detail/product-detail-closeup-new.jpg'); ?>" alt="" title="" class="temp"/>
                          </div>
                        <?php endif; ?>

                        <!-- <div class="manic-image-container">
                            <img src="" data-image-desktop="<?php echo $this->getSkinUrl('images_cms/product-detail/product-detail-closeup-new.jpg'); ?>" alt="" title="" class="temp"/>
                        </div> -->
                    </div>
                  <?php endif; ?>

                  <?php if (!$isGiftcardType) : ?>
                    <div class="row">
                      <div class="col-md-6">
                      </div>
                      <div class="col-md-6">

                        <div id="page-product-detail-instructions">
                          
                          <?php if(!$is_gift_product): ?>
                            <h2>Tea Origins & Brewing Instructions</h2>

                            <div class="detail-item-container">
                              <div class="detail-item">
                                <h4>Tea Type</h4>
                                <p><?php echo $_product->getData('tea_type'); ?></p>
                              </div>
                              <div class="detail-item">
                                <h4>Origin</h4>
                                <p><?php echo $_product->getData('origin'); ?></p>
                              </div>
                              <div class="detail-item">
                                <h4>harvest period</h4>
                                <p><?php echo $_product->getData('harvest_period'); ?></p>
                              </div>
                            </div> <!-- detail-item-container -->



                            <div class="detail-icon-container">
                              <div class="detail-icon">
                                <div class="detail-icon-image icon-teapot"></div>
                                <p><?php echo $_product->getTemperature(); ?></p>
                              </div>
                              <div class="detail-icon">
                                <div class="detail-icon-image icon-clock"></div>
                                <p><?php echo $_product->getTime(); ?></p>
                              </div>
                            </div>
                          <?php endif; ?>                    

                        </div> <!-- page-product-detail-instructions -->
                      </div>
                    </div>
                  <?php endif; ?>
              </div> <!-- page-product-detail-sidebar -->
          </div>
          <div class="<?php if ($isGiftcardType) : ?>col-md-6<?php else: ?>col-md-8<?php endif; ?>">
              <!--
                ____ ___  _   _ _____ _____ _   _ _____
               / ___/ _ \| \ | |_   _| ____| \ | |_   _|
              | |  | | | |  \| | | | |  _| |  \| | | |
              | |__| |_| | |\  | | | | |___| |\  | | |
               \____\___/|_| \_| |_| |_____|_| \_| |_|

              -->
              
              <div id="page-product-detail-content" <?php if ($isGiftcardType) : ?>class="gift-card-version"<?php endif; ?>>
                  <?php if (!$isGiftcardType && !$is_gift_product) : ?>
                  <div id="page-product-detail-banner">
                      <?php
                          $banner_image_exist = false;
                          foreach ($_images as $_image): 
                              if($_image->getLabel()=="banner"):
                                  $banner_image_exist = true;
                      ?>
                          <div class="manic-image-container">
                              <img src="" data-image-desktop="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->constrainOnly(false)->keepAspectRatio(true)->keepFrame(false)->resize(1163, null); ?>" alt="<?php echo $this->htmlEscape($_image->getLabel()) ?>" title="<?php echo $this->htmlEscape($_image->getLabel()) ?>" class=""/>
                          </div>
                      <?php   endif;
                          endforeach;
                      ?>
                      <?php if(!$banner_image_exist): // temporary ?>
                          <div class="manic-image-container">
                              <img src="" data-image-desktop="<?php echo $this->getSkinUrl('images_cms/product-detail/product-detail-banner.jpg'); ?>" alt="" title="" class=""/>
                          </div>
                      <?php endif; ?>
                  </div> <!-- page-product-detail-banner -->
                  <?php endif; ?>

                  <div class="row">
                    <?php if (!$isGiftcardType) : ?>
                      <div class="col-md-1"></div>
                      <div class="col-md-11">
                    <?php else: ?>
                      <div class="col-lg-11 col-lg-offset-1 col-md-11 col-md-offset-1 col-sm-8 col-sm-offset-2">
                    <?php endif; ?>

                      <div id="page-product-detail-copy" class="<?php if($is_gift_product) echo "gift-product-version"; ?>">
                
                        <div class="copy-title">                            
                          <h1><?php echo $_product->getName(); ?></h1>
                          <h3><strong><?php echo $_product->getData('product_name_in_color'); ?></strong></h3>
                          <?php if ($isGiftcardType) :?>
                            <ul class="gift-card-values">
                            <?php 
                            $gift_value = Mage::helper('giftvoucher/giftproduct')->getGiftValue($_product); 
                            foreach ($gift_value['prices'] as $key => $price) {
                              echo "<li>" . Mage::helper('core')->currency($price, true, false) . "</li>";
                            }
                            ?>
                            </ul>                            
                          <?php endif; ?>
                        </div>
                        
                        <?php if ($isGiftcardType) :?>
                          <div class="row gift-card-copy">
                            <div class="col-md-4"><p class="gift-card-copy-title">How to use</p ></div>
                            <div class="col-md-8"><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p></div>
                          </div>
                          <?php echo $this->getChildHtml('product_type_data') ?>                          
                        <?php else : ?>  
                          <div class="copy-price red-version">
                            <ul>
                              <li><?php echo $this->getPriceHtml($_product); ?></li>
                              <?php if(!$is_gift_product): ?>
                                <li><?php echo $_product->getData('number_of_sachet'); ?> silken sachets</li>
                              <?php endif; ?>
                              <li><?php echo str_replace('.0', '', number_format($_product->getData('weight'), 1)); ?> g</li>
                            </ul>
                          </div>

                          <div class="row">
                            <div class="<?php if ($is_gift_product) :?>col-md-4<?php else: ?>col-md-3<?php endif; ?>">
                              
                              <div class="copy-desc red-version">
                                <?php if($is_gift_product): ?>
                                  Diameter: <?php echo $_product->getData('diameter'); ?> <br>
                                  Height: <?php echo $_product->getData('height'); ?> <br><br>
                                  Made in <?php echo $_product->getData('country'); ?>
                                <?php else: ?>
                                  <?php echo $shortDescription; ?>  
                                <?php endif; ?>                                
                              </div> <!-- copy-desc -->

                            </div>
                            <div class="<?php if ($is_gift_product) :?>col-md-0<?php else: ?>col-md-1<?php endif; ?>"></div>
                            <div class="col-md-8">

                              <div class="detail-item-container">
                                <?php if(!$is_gift_product): ?>
                                <div class="detail-item">
                                  <h4>Ingredients</h4>
                                  <p><?php echo $_product->getIngredients(); ?></p>
                                </div>
                                <?php endif; ?>

                                <div class="detail-item">
                                  <?php if($is_gift_product): ?>
                                    <h4>Product Description</h4>
                                  <?php else: ?>
                                    <h4>Tea Maker’s Note</h4>
                                  <?php endif; ?>
                                  <p><?php echo (!empty($_product->getData('tea_makers_note'))) ? $_product->getData('tea_makers_note') : "" ; ?></p>
                                </div>
                              </div> <!-- detail-item-container -->

                            </div>
                          </div>
                        <?php endif; ?>


                      </div> <!-- page-product-detail-copy -->

                    </div>
                  </div>

                  <div id="page-product-detail-form-container">

                    <div class="row">

                      <div class="col-md-1"></div>
                      <div class="col-md-11 col-md-offset-0 col-sm-8 col-sm-offset-2">


                        <div id="page-product-detail-form" class="<?php if($is_gift_product) echo "gift-product-version"; ?>">
                          <?php if (!$this->hasOptions()):?>
                              
                              <?php if($_product->isSaleable()): ?>
                                  <?php echo $this->getChildHtml('addtocart') ?>
                              <?php else: ?>
                                <div class="row">
                                  <div class="col-md-8 col-md-push-4">
                                    <span class="out-of-stock">This item is currently out of stock.</span>
                                  </div>
                                </div>
                              <?php endif; ?>
                              <?php echo $this->getChildHtml('addto') ?>
                              
                              <?php echo $this->getChildHtml('extra_buttons') ?>
                          <?php elseif (!$_product->isSaleable()): ?>
                              <div class="row">
                                  <?php echo $this->getChildHtml('addto') ?>
                              </div>
                          <?php else: ?>
                            <div class="row">
                              <div class="col-md-12">
                                <h4>Out of Stock</h4>
                              </div>
                            </div>
                          <?php endif; ?>                            
                        </div> <!-- page-product-detail-form -->

                      </div> <!-- col-md-10 -->
                    </div> <!-- row -->
                  </div> <!-- page-product-detail-form-container -->
                  
                  <?php if (!$isGiftcardType && !$is_gift_product) : ?>
                    <div id="page-product-detail-content-image-container">
                      <div class="row">
                        <div class="col-md-1"></div>
                        <div class="col-md-11">
                          <div class="page-product-detail-content-image-title">
                            <h2>You may also like</h2>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-1"></div>
                        <div class="col-md-6">                          
                          <div class="page-product-detail-content-image">
                            <?php
                                $content_1_image_exist = false;
                                foreach ($_images as $_image): 
                                  $img_label = $_image->getLabel();                                  
                                    if(strpos($img_label, 'content-1') !== false):
                                      $product_name = explode('_', $img_label);             
                                      if(count($product_name) > 1) {
                                        $content_1_product = Mage::getModel('catalog/product')->loadByAttribute('name', $product_name[1]);
                                      }
                                      $content_1_image_exist = true;
                            ?>
                              <a href="<?php echo (isset($content_1_product)) ? $content_1_product->getUrlPath() : "#"; ?>" class="product-item-image">
                                <div class="manic-image-container">
                                    <img src="" data-image-desktop="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->constrainOnly(false)->keepAspectRatio(true)->keepFrame(false)->resize(850, 553); ?>" alt="<?php echo $this->htmlEscape($_image->getLabel()) ?>" title="<?php echo $this->htmlEscape($_image->getLabel()) ?>" class=""/>
                                </div>
                              </a>
                              <a href="<?php echo (isset($content_1_product)) ? $content_1_product->getUrlPath() : "#"; ?>" title="<?php echo $this->stripTags($this->getImageLabel($content_1_product, 'small_image'), null, true) ?>" class="product-item-title">           
                                  <h2 class="product-name"><?php echo $_helper->productAttribute($content_1_product, $content_1_product->getName() , 'name'); ?></h2> 
                                  <h3 class="product-name-in-color"><?php echo $content_1_product->getData('product_name_in_color'); ?></h3> 
                              </a>
                              <div class="product-item-price">
                                <?php echo $this->getPriceHtml($content_1_product, true) ?>
                              </div>
                            <?php   endif;
                                endforeach;
                            ?>
                            <?php if(!$content_1_image_exist): // temporary ?>
                                <div class="manic-image-container">
                                    <img src="" data-image-desktop="<?php echo $this->getSkinUrl('images_cms/product-detail/product-detail-content-01.jpg'); ?>" alt="" title="" class=""/>
                                </div>
                            <?php endif; ?>
                          </div>
                        </div>
                        <div class="col-md-5">
                          <div class="page-product-detail-content-image">
                            <?php
                                $content_2_image_exist = false;
                                foreach ($_images as $_image): 
                                    $img_label = $_image->getLabel();
                                    $product_name = explode('_', $img_label);
                                    if(strpos($img_label, 'content-2') !== false):
                                      $product_name = explode('_', $img_label);             
                                      if(count($product_name) > 1) {
                                        $content_2_product = Mage::getModel('catalog/product')->loadByAttribute('name', $product_name[1]);
                                      }
                                      $content_2_image_exist = true;
                            ?>
                              <a href="<?php echo (isset($content_2_product)) ? $content_2_product->getUrlPath() : "#"; ?>" class="product-item-image">
                                <div class="manic-image-container has-show-all">
                                    <img src="" data-image-desktop="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->constrainOnly(false)->keepAspectRatio(true)->keepFrame(false)->resize(440, null); ?>" alt="<?php echo $this->htmlEscape($_image->getLabel()) ?>" title="<?php echo $this->htmlEscape($_image->getLabel()) ?>" class=""/>
                                </div>
                              </a>
                              <a href="<?php echo (isset($content_2_product)) ? $content_2_product->getUrlPath() : "#"; ?>" title="<?php echo $this->stripTags($this->getImageLabel($content_2_product, 'small_image'), null, true) ?>" class="product-item-title">           
                                  <h2 class="product-name"><?php echo $_helper->productAttribute($content_2_product, $content_2_product->getName() , 'name'); ?></h2> 
                                  <h3 class="product-name-in-color"><?php echo $content_2_product->getData('product_name_in_color'); ?></h3> 
                              </a>
                              <div class="product-item-price">
                                <?php echo $this->getPriceHtml($content_2_product, true) ?>
                              </div>
                            <?php   endif;
                                endforeach;
                            ?>
                            <?php if(!$content_2_image_exist): // temporary ?>
                                <div class="manic-image-container">
                                    <img src="" data-image-desktop="<?php echo $this->getSkinUrl('images_cms/product-detail/product-detail-content-02.jpg'); ?>" alt="" title="" class=""/>
                                </div>
                            <?php endif; ?>
                          </div>
                        </div>
                      </div>
                    </div> <!-- page-product-detail-content-image-container -->
                  <?php endif; ?>


              </div> <!-- page-product-detail-content -->
          </div>
      </div>
      <?php if ($isGiftcardType) : ?>
      <div id="gift-card-social-media-share-container" class="row">
          <div class="col-md-3 col-lg-2">     
            <?php $gifts_products = Mage::getModel('catalog/category')->loadByAttribute('name', 'gifts'); ?>       
            <a href="<?php echo $gifts_products->getUrl(); ?>" class="arrow-cta reverse-version">Back to gifts</a>            
          </div>
          <div class="col-lg-offset-8 col-lg-2 col-md-offset-6 col-md-3">
            <?php $_helper = $this->helper('catalog/output'); ?>
            <?php $_productName = urlencode(trim($_helper->productAttribute($_product, $_product->getName(), 'name')))?>
            <?php $_productImageUrl = urlencode(trim($this->helper('catalog/image')->init($_product, 'image')))?>
            <?php $_productUrl = urlencode(trim($_product->getProductUrl()))?>
            
            <div class="form-group social-media-share">
              <div class="row">
                <div class="col-md-5"><h4>Share</h4></div>
                <div class="col-md-7">
                  <ul class="social-sharing">
                      <?php //if ($this->canEmailToFriend()): ?>
                          <!-- <li><a href="<?php echo $this->helper('catalog/product')->getEmailToFriendUrl($_product) ?>" class="link-email-friend" title="<?php echo $this->__('Email to a Friend') ?>"><?php echo $this->__('Email to a Friend') ?></a></li> -->
                      <?php //endif; ?>

                      <?php $_helper = $this->helper('catalog/output'); ?>
                      <?php $_productName = urlencode(trim($_helper->productAttribute($_product, $_product->getName(), 'name')))?>
                      <?php $_productImageUrl = urlencode(trim($this->helper('catalog/image')->init($_product, 'image')))?>
                      <?php $_productUrl = urlencode(trim($_product->getProductUrl()))?>
                      <!-- <li><a href="#" class="instagram"></a></li> -->
                      <li>
                          <?php $_u = 'p[url]=' . $_productUrl . '&p[images][0]=' . $_productImageUrl . '&p[title]=' . $_productName . '&p[summary]=' . urlencode(trim($_helper->productAttribute($_product, nl2br($_product->getShortDescription()), 'short_description'))); ?>        
                          <a href="<?php echo Mage::helper('core/url')->getCurrentUrl(); ?>" target="_blank" title="<?php echo $this->__('Share on Facebook') ?>" class="fa fa-facebook">
                          </a>
                      </li>    
                      <!-- <li>        
                          <a href="<?php echo 'https://twitter.com/share?url=' . $_productUrl . '&text=' . $_productName; ?>" target="_blank" title="<?php echo $this->__('Share on Twitter') ?>" class="fa fa-twitter" target="_blank"></a>
                      </li> -->
                      <li>
                          <!-- <a href="http://pinterest.com/pin/create/button/?url=<?php echo $_productUrl; ?>&media=<?php echo $_productImageUrl; ?>&description=<?php echo $_productName; ?>" class="pintrest" target="_blank"></a> -->
                          <a href="http://pinterest.com/pin/create/button/?url=<?php echo $_productUrl; ?>&media=<?php echo $_productImageUrl; ?>&description=<?php echo $_productName; ?>" class="fa fa-pinterest" target="_blank"></a>
                      </li>
                  </ul>
                </div>
              </div>
              <?php         
              $_productImageUrl_Raw = $this->helper('catalog/image')->init($_product, 'image')->resize(158);
              ?>
              <script>
                  jQuery('.fa-facebook').on('click', function(e){
                      e.preventDefault();
                      var share_url = jQuery(this).attr('href');
                      FB.ui({
                          display: 'popup',
                          method: 'share',
                          title: 'Monogram E-Gift Card - Monogram Tea',
                          href: share_url,
                          picture: '<?php echo $_productImageUrl_Raw; ?>'
                      }, function(response){});
                  });

                  function PopupCenter(pageURL, title,w,h) {
                      var left = (screen.width/2)-(w/2);
                      var top = (screen.height/2)-(h/2);
                      var targetWin = window.open (pageURL, title, 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);
                      return targetWin;
                  } 

                  $j('.fa-twitter').on('click', function(e){
                      e.preventDefault();
                      var share_url = $(this).attr('href');
                      PopupCenter(share_url,'', 500, 500);
                  });
                  $j('.fa-pinterest').on('click', function(e){
                      e.preventDefault();
                      var share_url = $(this).attr('href');
                      PopupCenter(share_url,'', 500, 500); 
                  });   
                </script>
            </div>
          </div>
      </div>
      <?php endif; ?>
    </div>
</article> <!-- page-product-detail-content-section -->

<!--
   _____ ___   ___ _____ _____ ____
  |  ___/ _ \ / _ \_   _| ____|  _ \
  | |_ | | | | | | || | |  _| | |_) |
  |  _|| |_| | |_| || | | |___|  _ <
  |_|   \___/ \___/ |_| |_____|_| \_\

-->
<?php if (!$isGiftcardType) : ?>
<article id="page-product-detail-footer-section" class="visible-md visible-lg">
  <div class="container-fluid has-breakpoint">
    <div class="row">
      <div class="col-md-12">

        <div id="page-product-detail-footer">
          <hr>
          <?php $store_category = Mage::getModel('catalog/category')->loadByAttribute('name', 'Shop'); ?>
          <?php $gifts_products = Mage::getModel('catalog/category')->loadByAttribute('name', 'gifts'); ?>
          <?php $gifts_products_data = $gifts_products->getData(); ?>
          
          <div id="page-product-back-btn-container">
            <?php if(!$is_gift_product): ?>
              <a href="<?php echo $store_category->getUrl(); ?>" class="arrow-cta reverse-version">Back to shop</a>
            <?php else: ?>
              <a href="<?php echo $gifts_products->getUrl(); ?>" class="arrow-cta reverse-version">Back to gifts</a>
            <?php endif; ?>
          </div>
          <div id="page-product-social-container">
            <h4>Share</h4>
            <?php echo $this->getChildHtml('sharing') ?>            
          </div>
        </div> <!-- page-product-detail-footer -->

      </div>
    </div>
  </div>
</article>
<?php endif; ?>
<!--
   __  __  ___  ____ ___ _     _____
  |  \/  |/ _ \| __ )_ _| |   | ____|
  | |\/| | | | |  _ \| || |   |  _|
  | |  | | |_| | |_) | || |___| |___
  |_|  |_|\___/|____/___|_____|_____|

-->
<?php if (!$isGiftcardType) : ?>
<article id="page-product-detail-banner-section-mobile" class="visible-sm visible-xs">
  
  <?php if($is_gift_product): ?>

    <div id="page-product-detail-closeup-mobile" class="gift-product-version">
      <?php
          $closeup_tablet_exist = false;
          $closeup_mobile_exist = false;
          foreach ($_images as $_image): 
              if($_image->getLabel()=="closeup-tablet"):
                $closeup_tablet_exist = true;    
                $closeup_tablet_url = $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->constrainOnly(false)->keepAspectRatio(true)->keepFrame(false);              
              endif;
              if($_image->getLabel()=="closeup-mobile"):
                $closeup_mobile_exist = true;
                $closeup_mobile_url = $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->constrainOnly(false)->keepAspectRatio(true)->keepFrame(false);              
              endif;
              $img_lbl = $this->htmlEscape($_image->getLabel());
              $img_title = $this->htmlEscape($_image->getLabel());
          endforeach;
      ?>
      <?php if($closeup_tablet_exist && $closeup_mobile_exist): // temporary ?>
        <div class="manic-image-container has-show-all">
            <img src="" 
              data-image-tablet="<?php echo $closeup_tablet_url; ?>" 
              data-image-mobile="<?php echo $closeup_mobile_url; ?>" alt="<?php echo $img_lbl; ?>" title="<?php echo $img_title ?>" class=""/>
        </div>
      <?php else: ?>
        <div class="manic-image-container has-show-all">
          <img src="" 
            data-image-tablet="<?php echo $this->getSkinUrl('images_cms/product-detail/product-detail-closeup-tablet.jpg'); ?>"
            data-image-mobile="<?php echo $this->getSkinUrl('images_cms/product-detail/product-detail-closeup-mobile.jpg'); ?>">
        </div>
      <?php endif; ?>
    </div>

  <?php else: ?>

    <div id="page-product-detail-banner-mobile">
      <?php
          $banner_tablet_exist = false;
          $banner_mobile_exist = false;
          foreach ($_images as $_image): 
              if($_image->getLabel()=="banner-tablet"):
                $banner_tablet_exist = true;    
                $banner_tablet_url = $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->constrainOnly(false)->keepAspectRatio(true)->keepFrame(false)->resize(1163, null);              
              endif;
              if($_image->getLabel()=="banner-mobile"):
                $banner_mobile_exist = true;    
                $banner_mobile_url = $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->constrainOnly(false)->keepAspectRatio(true)->keepFrame(false)->resize(1163, null);              
              endif;
              $img_lbl = $this->htmlEscape($_image->getLabel());
              $img_title = $this->htmlEscape($_image->getLabel());
          endforeach;
      ?>
      <?php if($banner_tablet_exist && $banner_mobile_exist): // temporary ?>
        <div class="manic-image-container">
            <img src="" 
              data-image-tablet="<?php echo $banner_tablet_url; ?>" 
              data-image-mobile="<?php echo $banner_mobile_url; ?>" alt="<?php echo $img_lbl; ?>" title="<?php echo $img_title ?>" class=""/>
        </div>
      <?php else: // temporary ?>        
          <div class="manic-image-container">
            <img src="" 
              data-image-tablet="<?php echo $this->getSkinUrl('images_cms/product-detail/product-detail-banner-tablet.jpg'); ?>"
              data-image-mobile="<?php echo $this->getSkinUrl('images_cms/product-detail/product-detail-banner-mobile.jpg'); ?>">
          </div>
      <?php endif; ?>    
    </div> <!-- page-product-detail-banner -->

  <?php endif; ?>

</article> <!-- page-product-detail-banner-section-mobile -->

<article id="page-product-detail-content-section-mobile" class="visible-sm visible-xs">

    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-0 col-sm-1"></div>
        <div class="col-xs-12 col-sm-10">

          <div id="page-product-detail-content-mobile">

            <div class="copy-title">
              <h1><?php echo $_product->getName(); ?></h1>
              <h3><strong><?php echo $_product->getData('product_name_in_color'); ?></strong></h3>
            </div>

            <div class="copy-price red-version">
              <ul>
                <li><?php echo $this->getPriceHtml($_product); ?></li>
                <?php if(!$is_gift_product): ?>
                  <li><?php echo $_product->getData('number_of_sachet'); ?> silken sachets</li>
                <?php endif; ?>
                <li><?php echo number_format($_product->getData('weight'), 1); ?> g</li>
              </ul>
            </div>
            
            <?php if(!$is_gift_product): ?>
            <div id="page-product-detail-closeup-mobile">
              <?php
                  $closeup_tablet_exist = false;
                  $closeup_mobile_exist = false;
                  foreach ($_images as $_image): 
                      if($_image->getLabel()=="closeup-tablet"):
                        $closeup_tablet_exist = true;    
                        $closeup_tablet_url = $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->constrainOnly(false)->keepAspectRatio(true)->keepFrame(false)->resize(1163, null);              
                      endif;
                      if($_image->getLabel()=="closeup-mobile"):
                        $closeup_mobile_exist = true;
                        $closeup_mobile_url = $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->constrainOnly(false)->keepAspectRatio(true)->keepFrame(false)->resize(1163, null);              
                      endif;
                      $img_lbl = $this->htmlEscape($_image->getLabel());
                      $img_title = $this->htmlEscape($_image->getLabel());
                  endforeach;
              ?>
              <?php if($closeup_tablet_exist && $closeup_mobile_exist): // temporary ?>
                <div class="manic-image-container">
                    <img src="" 
                      data-image-tablet="<?php echo $closeup_tablet_url; ?>" 
                      data-image-mobile="<?php echo $closeup_mobile_url; ?>" alt="<?php echo $img_lbl; ?>" title="<?php echo $img_title ?>" class=""/>
                </div>
              <?php else: ?>
                <div class="manic-image-container">
                  <img src="" 
                    data-image-tablet="<?php echo $this->getSkinUrl('images_cms/product-detail/product-detail-closeup-tablet.jpg'); ?>"
                    data-image-mobile="<?php echo $this->getSkinUrl('images_cms/product-detail/product-detail-closeup-mobile.jpg'); ?>">
                </div>
              <?php endif; ?>
            </div>
            <?php endif; ?>                            
            
            <?php if(!$is_gift_product): ?>
            <div class="copy-desc">
              <p><?php echo $shortDescription; ?></p>
            </div> <!-- copy-desc -->

            <div class="detail-item-container">
              <div class="detail-item">
                <h4>Ingredients</h4>
                <p><?php echo $_product->getIngredients(); ?></p>
              </div>
            </div>
            <?php else: ?>
            <div class="detail-item-container">
              <div class="detail-item">
                <h4>Product description</h4>
                <p><?php echo $shortDescription; ?></p>
              </div>
            </div>
            <?php endif; ?>

            <div id="page-product-detail-form-mobile">
              
              <?php if($_product->isSaleable()): ?>
                  <?php echo $this->getChildHtml('addtocart') ?>
              <?php else: ?>
                <div class="row">
                  <div class="col-md-8 col-md-push-4">
                    <span class="out-of-stock">This item is currently out of stock.</span>
                  </div>
                </div>
              <?php endif; ?>              

            </div> <!-- page-product-detail-form-mobile -->

          </div> <!-- page-product-detail-content-mobile -->

        </div>
      </div>
    </div>
</article> <!-- page-product-detail-content-section-mobile -->


  
<article id="page-product-detail-expanding-section-mobile" class="visible-sm visible-xs">

    <div class="manic-expand-container" data-group="product-detail-mobile" data-value="product-detail-expand">
      <div class="scroll-target" data-value="product-detail-expand"></div>
      <div class="container-fluid">
          <div class="row">
            <div class="col-xs-0 col-sm-1"></div>
            <div class="col-xs-12 col-sm-10">
              <div class="manic-expand-container-title">        
                <h4>Product Details</h4>
              </div>
              <div class="manic-expand-container-btn"></div>                
            </div>
          </div>
      </div>                
      <div class="manic-expand-container-content">   
        <div class="container-fluid">
          <div class="row">
            <div class="col-xs-0 col-sm-1"></div>
            <div class="col-xs-12 col-sm-10">             
              <div class="detail-item-container">

                <?php if($is_gift_product): ?>
                  <div class="detail-item">
                    <h4>Dimensions:</h4>
                    <p>Diameter: <?php echo $_product->getData('diameter'); ?><br>
                    Height: <?php echo $_product->getData('diameter'); ?></p>
                    <p>Made in <?php echo $_product->getData('country'); ?></p>
                  </div>                  
                <?php else: ?>
                  <div class="detail-item">
                    <h4>Tea Type:</h4>
                    <p><?php echo $_product->getData('tea_type'); ?></p>
                  </div>
                  <div class="detail-item">
                    <h4>Origin:</h4>
                    <p><?php echo $_product->getData('origin'); ?></p>
                  </div>
                  <div class="detail-item">
                    <h4>Harvest period:</h4>
                    <p><?php echo $_product->getData('harvest_period'); ?></p>
                  </div>
                  <div class="detail-item">
                    <h4>Tea Maker’s Note:</h4>
                    <p><?php echo (!empty($_product->getData('tea_makers_note'))) ? $_product->getData('tea_makers_note') : "Delicate, floral sweet aroma of white peach brings harmony to a smooth finish." ; ?></p>
                  </div>
                <?php endif; ?>

              </div>
            </div>
          </div>
        </div>                      
      </div>
    </div>
    
    <?php if(!$is_gift_product): ?>
    <div class="manic-expand-container" data-group="product-detail-mobile" data-value="brewing-instructions-expand">
      <div class="scroll-target" data-value="brewing-instructions-expand"></div>
      <div class="container-fluid">
        <div class="row">
          <div class="col-xs-0 col-sm-1"></div>
          <div class="col-xs-12 col-sm-10">
            <div class="manic-expand-container-title">          
              <h4>Brewing Instructions</h4>              
            </div>
            <div class="manic-expand-container-btn"></div>              
          </div>
        </div>
      </div>
      <div class="manic-expand-container-content">
        <div class="container-fluid">
          <div class="row">
            <div class="col-xs-0 col-sm-1"></div>
            <div class="col-xs-12 col-sm-10">

              <div class="detail-icon-container">
                <div class="detail-icon">
                  <div class="detail-icon-image icon-teapot"></div>
                  <p><?php echo $_product->getTemperature(); ?></p>
                </div>
                <div class="detail-icon">
                  <div class="detail-icon-image icon-clock"></div>
                  <p><?php echo $_product->getTime(); ?></p>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
    <?php endif; ?>

</article> <!-- page-product-detail-expanding-section-mobile -->
  
<?php endif; ?>
</form>

<script type="text/javascript">
//<![CDATA[

    function do_update() {

        jQuery("#desktop-header-cart-menu").find(".cart-btn-value").removeClass('animated fadeIn').addClass('animated flipOutX');

        jQuery.ajax({
            url: '<?php echo $this->getUrl("discovertea/index/cartpreview"); ?>',
            dataType: 'json',
            type : 'get',
            success: function(data){

                if(isMobile) {
                  jQuery("#mobile-header-push-noti").slideDown(300);
                  jQuery("#mobile-header-push-noti").delay(5000).slideUp(300);
                }

                // update product count in cart
                jQuery("#mobile-header-cart-btn").find(".cart-btn-value").text(data.cart_qty);
                jQuery("#desktop-header-cart-menu").find(".cart-btn-value").text(data.cart_qty);
                // jQuery("#mobile-header-cart-btn-container").find(".count").text(data.cart_qty);

                jQuery("#desktop-header-cart-menu").find(".cart-btn-value").removeClass('animated flipOutX').addClass('animated fadeIn');

                jQuery('.desktop-header-cart-expand').html('');

                if(data.cart_qty > 0) {

                    jQuery.each(data.cart_items, function(key,value){

                        jQuery('.desktop-header-cart-expand').append('<ul class="desktop-header-cart-expand-content"><li><div class="manic-image-container"><img src="'+value.image+'" alt=""></div></li><li><p>'+value.qty+' x</p><p>'+value.name+'</p><p>'+value.name_in_color+'</p><p>'+value.row_price+'</p></li><li><a href="#" title="<?php echo $this->__('Remove item')?>" data-item-id="'+value.id+'" class="close-btn remove-item"></a></li></ul>');

                    });                    

                } else {

                    jQuery('.desktop-header-cart-expand').append('<ul class="desktop-header-cart-expand-content"><li class="empty-cart"><p>Your cart is empty.</p></li></ul>');

                }       

                jQuery('.desktop-header-cart-expand-summary').find('.sub-total-amount').html(data.cart_total);

                jQuery('#desktop-header-cart-expand-container').slideDown(300);
                window.header_cart_is_open = true;
                jQuery('#desktop-header-cart-expand-container').delay(5000).slideUp(300);

                setTimeout(function() {
                  window.header_cart_is_open = false;
                }, 5000);

                // var mobile_header = jQuery("#main-mobile-header").data('gryphon_mobile_header');
                // mobile_header.public_open_cart();
                //jQuery('#mobile-cart-expand-container').show();
                

                // jQuery('.mobile-cart-button').find('span').html(data.cart_qty);
                // jQuery('.cart-summary-data').find('.price').html(data.cart_total);
                // jQuery('.cart-summary-data').find('.count').html(data.cart_qty);
                // jQuery('.cart-summary-data span').html('<span class="price">'+data.cart_total+'</span> (<span class="count">'+data.cart_qty+'</span>)');                            
            }
        });                     
    }

    var isMobile = false; //initiate as false
    // device detection
    if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) 
        || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))) isMobile = true;

    var productAddToCartForm = new VarienForm('product_addtocart_form');
    productAddToCartForm.submit = function(button, url) {
        if (this.validator.validate()) {
            var form = this.form;
            var oldUrl = form.action;

            if (url) {
               form.action = url;
            }
            var e = null;
            // try {
            //     this.form.submit();
            // } catch (e) {
            // }
            //Start of our new ajax code
            if(!url){
                url = jQuery('#product_addtocart_form').attr('action');
            }

            if(isMobile) {
              jQuery("#page-product-detail-form").find(".form-quantity-input-txt").prop('disabled', true);   
              jQuery("#page-product-detail-form-mobile").find(".form-quantity-input-txt").prop('disabled', false);   
            }else {
              jQuery("#page-product-detail-form").find(".form-quantity-input-txt").prop('disabled', false);
              jQuery("#page-product-detail-form-mobile").find(".form-quantity-input-txt").prop('disabled', true);
            }

            var data = jQuery('#product_addtocart_form').serialize();
            data += '&isAjax=1';   
            jQuery('#ajax_loader_product').show();            

            var product_id = jQuery(form).find('input[name="product"]').val(); //gift card product id = 907

            var subscription_in_the_cart = <?php echo $subscription_in_the_cart; ?>;
            var gift_in_the_cart = <?php echo $gift_in_the_cart; ?>;


            var cart_count = <?php echo Mage::helper('checkout/cart')->getItemsCount(); ?>                     

            if(subscription_in_the_cart==1) {                                
                alert('This product cannot be purchased with other items in the cart. Please check out first before making this purchase.');
                //jQuery('span.ajax_msg_product').html('This product cannot be purchased with other items in the cart. Please check out first before making this purchase.').show();
                jQuery('#ajax_loader_product').hide();
            } else if(gift_in_the_cart==1 && product_id != 907) {
                alert('This product cannot be purchased with other items in the cart. Please check out first before making this purchase.');
                //jQuery('span.ajax_msg_product').html('This product cannot be purchased with other items in the cart. Please check out first before making this purchase.').show();
                jQuery('#ajax_loader_product').hide();                        
            } else if(product_id == 907 && gift_in_the_cart==0 && cart_count > 0) {
                alert('This product cannot be purchased with other items in the cart. Please check out first before making this purchase.');
                //jQuery('span.ajax_msg_product').html('This product cannot be purchased with other items in the cart. Please check out first before making this purchase.').show();
                jQuery('#ajax_loader_product').hide();                        
            }else {
                try {
                    jQuery.ajax({
                        url: url,
                        dataType: 'json',
                        type : 'post',
                        data: data,
                        success: function(data){
                            jQuery('#ajax_loader_product').hide();
                            console.log(data.status + ": " + data.message);

                            if(data.status=="ERROR") {
                                jQuery('span.ajax_msg_product').html(data.message).show().delay(5000).fadeOut();
                            }else {
                                do_update();
                                // jQuery('span.ajax_msg_product').html('Added to cart!').show().delay(5000).fadeOut();
                            }
                        },
                        error: function() {
                            console.log(jqXHR, textStatus, errorThrown);
                            do_update();
                            jQuery('span.ajax_msg_product').html('Added to cart!').show().delay(5000).fadeOut();
                        }
                    });
                } catch (e) {
                }                                
            }
            //End of our new ajax code    
            this.form.action = oldUrl;
            if (e) {
                throw e;
            }

            // if (button && button != 'undefined') {
            //     button.disabled = true;
            // }
        }
    }.bind(productAddToCartForm);

    productAddToCartForm.submitLight = function(button, url){
        if(this.validator) {
            var nv = Validation.methods;
            delete Validation.methods['required-entry'];
            delete Validation.methods['validate-one-required'];
            delete Validation.methods['validate-one-required-by-name'];
            // Remove custom datetime validators
            for (var methodName in Validation.methods) {
                if (methodName.match(/^validate-datetime-.*/i)) {
                    delete Validation.methods[methodName];
                }
            }

            if (this.validator.validate()) {
                if (url) {
                    this.form.action = url;
                }
                this.form.submit();
            }
            Object.extend(Validation.methods, nv);
        }
    }.bind(productAddToCartForm);
//]]>
</script>