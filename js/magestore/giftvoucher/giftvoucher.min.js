function toggleTotalCode(){$$(".giftvoucher-total-code").each(function(e){e.toggle()})}function addGiftVoucher(){var e=$("giftvoucher_code").value,t="";if($("giftvoucher_existed_code")&&(t=$("giftvoucher_existed_code").value),""!=e||""!=t){$("giftcard_notice_1")&&($("giftcard_notice_1").style.display="none"),$("giftcard_notice_2")&&($("giftcard_notice_2").style.display="none"),$("giftvoucher_code")&&$("giftvoucher_code").removeClassName("validation-failed"),$("giftvoucher_existed_code")&&$("giftvoucher_existed_code").removeClassName("validation-failed"),$("giftvoucher_add").hide(),$("giftvoucher_wait").show();var o=$("giftvoucher_cache_url").innerHTML.stripTags();for(i=0;i<o.length;i++)"/"==o[o.length-1]&&(o=o.substr(0,o.length-1));""!=e&&(o+="/code/"+e),""!=t&&(o+="/addcode/"+t),new Ajax.Request(o,{method:"post",postBody:"",onException:function(e,t){$("giftvoucher_message").update('<ul class="error-msg"><li>'+t+"</li></ul>")},onComplete:function(e){if(e.responseText.isJSON()){var t=e.responseText.evalJSON(),i=!0;if(t.ajaxExpired&&t.ajaxRedirect&&(setLocation(t.ajaxRedirect),i=!1),i&&t.updatepayment){var o=getElement();o.hide(),$("giftvoucher_container").down("dd.giftvoucher").hide(),$("giftvoucher_ajaxload").show(),"undefined"!=typeof shippingMethod?shippingMethod.save():"undefined"!=typeof billing&&billing.save()}else if(i){if(t.html){var n=$("giftvoucher_container");n.innerHTML=t.html,$("payment_form_giftvoucher").show()}else $("giftvoucher_wait").hide(),$("giftvoucher_add").show();var d="";t.success&&(d='<ul class="success-msg"><li>'+t.success+"</li></ul>","undefined"!=typeof save_shipping_method&&save_shipping_method(shipping_method_url,enable_update_payment,!0)),t.notice&&(d+='<ul class="notice-msg"><li>'+t.notice+"</li></ul>"),t.error&&(d+='<ul class="error-msg"><li>'+t.error+"</li></ul>"),""!=d&&$("giftvoucher_message").update(d)}}else $("giftvoucher_wait").hide(),$("giftvoucher_add").show(),alert(e.responseText);"undefined"!=typeof save_shipping_method&&save_shipping_method(shipping_method_url,enable_update_payment,!0)}})}else""==e&&""==t?($("giftcard_notice_1")&&null==$("giftvoucher_existed_code")?$("giftcard_notice_1").style.display="block":$("giftcard_notice_2").style.display="block",$("giftvoucher_code")&&$("giftvoucher_code").addClassName("validation-failed"),$("giftvoucher_existed_code")&&$("giftvoucher_existed_code").addClassName("validation-failed")):payment.save()}function removeGiftVoucher(e){var t=$(e.id),o=t.children[0].value;for(i=0;i<o.length;i++)"/"==o[o.length-1]&&(o=o.substr(0,o.length-1));var n=t.id,d=$(n+"_remove"),r=$(n+"_ajax");d.hide(),t.hide(),r.show();new Ajax.Request(o,{method:"post",postBody:"",onException:function(e,t){$("giftvoucher_message").update('<ul class="error-msg"><li>'+t+"</li></ul>")},onComplete:function(e){if(e.responseText.isJSON()){var i=e.responseText.evalJSON(),o=!0;if(i.ajaxExpired&&i.ajaxRedirect&&(setLocation(i.ajaxRedirect),o=!1),o&&i.updatepayment){var n=getElement();n.hide(),$("giftvoucher_container").down("dd.giftvoucher").hide(),$("giftvoucher_ajaxload").show(),"undefined"!=typeof shippingMethod?shippingMethod.save():"undefined"!=typeof billing&&billing.save()}else if(o){if(i.html){var a=$("giftvoucher_container");a.innerHTML=i.html,$("payment_form_giftvoucher").show()}else r.hide(),t.show(),d.show();var c="";i.success&&(c='<ul class="success-msg"><li>'+i.success+"</li></ul>","undefined"!=typeof save_shipping_method&&save_shipping_method(shipping_method_url,enable_update_payment,!0)),i.error&&(c+='<ul class="error-msg"><li>'+i.error+"</li></ul>"),""!=c&&$("giftvoucher_message").update(c)}}else r.hide(),t.show(),d.show(),alert(e.responseText);"undefined"!=typeof save_shipping_method&&save_shipping_method(shipping_method_url,enable_update_payment,!0)}})}function changeUseGiftvoucher(e){var t=$("giftvoucher_cache_url").innerHTML.stripTags().replace("/addgift","/giftcard");for(i=0;i<t.length;i++)"/"==t[t.length-1]&&(t=t.substr(0,t.length-1));e.checked?($("payment_form_giftvoucher").show(),changeGiftcardVisible("giftvoucher",!1),t+="/giftvoucher/1"):($("payment_form_giftvoucher").hide(),changeGiftcardVisible("giftvoucher",!0));var o=getElement();o.hide(),$("giftvoucher_container").down("dd.giftvoucher").hide(),$("giftvoucher_ajaxload").show(),new Ajax.Request(t,{method:"post",postBody:"",onComplete:function(e){if(e.responseText.isJSON()){var t=e.responseText.evalJSON();if(t.updatepayment)"undefined"!=typeof shippingMethod?shippingMethod.save():"undefined"!=typeof billing&&billing.save();else{var i=getElement();i.show(),$("giftvoucher_container").down("dd.giftvoucher").show(),$("giftvoucher_ajaxload").hide()}}else{var i=getElement();i.show(),$("giftvoucher_container").down("dd.giftvoucher").show(),$("giftvoucher_ajaxload").hide()}"undefined"!=typeof save_shipping_method&&save_shipping_method(shipping_method_url,enable_update_payment,!0)}})}function onLoadGiftvoucherForm(){$("giftvoucher")&&($("giftvoucher").disabled=!1,$("giftvoucher").checked?($("payment_form_giftvoucher").show(),changeGiftcardVisible("giftvoucher",!1)):($("payment_form_giftvoucher").hide(),changeGiftcardVisible("giftvoucher",!0))),$("giftvoucher_credit")&&($("giftvoucher_credit").disabled=!1,$("giftvoucher_credit").checked?($("payment_form_giftvoucher_credit").show(),changeGiftcardVisible("giftvoucher_credit",!1)):($("payment_form_giftvoucher_credit").hide(),changeGiftcardVisible("giftvoucher_credit",!0)))}function useExistedGiftcard(e){e.value?$("giftvoucher-custom-code").hide():$("giftvoucher-custom-code").show()}function changeUseExistedGiftcard(e){e.value?($("giftvoucher-custom-code").hide(),changeGiftcardVisible("giftvoucher-custom-code",!0)):($("giftvoucher-custom-code").show(),changeGiftcardVisible("giftvoucher-custom-code",!1))}function showGiftCardInput(e){var t=Element.extend(e.parentNode);e.hide(),t.down(".giftcard_input").show(),t.down(".giftcard_input input").focus()}function showGiftCardAmountInput(e){var t=Element.extend(e.parentNode);e.hide(),t.down("input").show(),t.down("input").disabled=!1}function enterUpdateGiftCardInput(e,t){13==t.keyCode&&updateGiftCardInput(e)}function updateGiftCardInput(e){var t=Element.extend(e.parentNode);t.down(".apply").hide(),t.down(".ajax-loader").show();var o=$("giftvoucher_cache_url").innerHTML.stripTags().replace("/addgift","/updateAmount");for(i=0;i<o.length;i++)"/"==o[o.length-1]&&(o=o.substr(0,o.length-1));var n=Element.extend(e.parentNode.parentNode.parentNode.parentNode).down("button").id;o+="/code/"+n,o+="/amount/"+t.down("input").value,new Ajax.Request(o,{method:"post",postBody:"",parameters:"",onException:function(e,t){$("giftvoucher_message").update('<ul class="error-msg"><li>'+t+"</li></ul>")},onComplete:function(i){if(e.show(),t.down(".ajax-loader").hide(),i.responseText.isJSON()){var o=i.responseText.evalJSON(),d=!0;if(o.ajaxExpired&&o.ajaxRedirect&&(setLocation(o.ajaxRedirect),d=!1),d&&o.updatepayment){var r=getElement();r.hide(),$("giftvoucher_container").down("dd.giftvoucher").hide(),$("giftvoucher_ajaxload").show(),"undefined"!=typeof shippingMethod?shippingMethod.save():"undefined"!=typeof billing&&billing.save()}else if(d){if(o.amount&&($(n+"_remove").down(".giftcard-amount").update(o.amount),t.hide(),t=Element.extend(t.parentNode),t.down(".giftcard_change").show()),o.html){var a=$("giftvoucher_container");a.innerHTML=o.html,$("payment_form_giftvoucher").show()}var c="";o.success&&(c='<ul class="success-msg"><li>'+o.success+"</li></ul>","undefined"!=typeof save_shipping_method&&save_shipping_method(shipping_method_url,enable_update_payment,!0)),o.error&&(c+='<ul class="error-msg"><li>'+o.error+"</li></ul>"),""!=c&&$("giftvoucher_message").update(c)}}"undefined"!=typeof save_shipping_method&&save_shipping_method(shipping_method_url,enable_update_payment,!0)}})}function changeUseGiftCredit(e){var t=$("giftvoucher_cache_url").innerHTML.stripTags().replace("/addgift","/giftcardcredit");for(i=0;i<t.length;i++)"/"==t[t.length-1]&&(t=t.substr(0,t.length-1));e.checked?($("payment_form_giftvoucher_credit").show(),changeGiftcardVisible("giftvoucher_credit",!1),t+="/giftcredit/1"):($("payment_form_giftvoucher_credit").hide(),changeGiftcardVisible("giftvoucher_credit",!0));var o=getElement();o.hide(),$("giftvoucher_container").down("dt.giftvoucher").hide(),$("giftvoucher_container").down("dd.giftvoucher").hide(),$("giftvoucher_container").down("dd.giftvoucher_credit").hide(),$("giftvoucher_credit_ajaxload").show(),new Ajax.Request(t,{method:"post",postBody:"",onComplete:function(e){if(e.responseText.isJSON()){var t=e.responseText.evalJSON();if(t.updatepayment)"undefined"!=typeof shippingMethod?shippingMethod.save():"undefined"!=typeof billing&&billing.save();else if(t.html){var i=$("giftvoucher_container");i.innerHTML=t.html,onLoadGiftvoucherForm();var o=getElement();o.show()}else{var o=getElement();o.show(),$("giftvoucher_container").down("dt.giftvoucher").show(),$("giftvoucher_container").down("dd.giftvoucher").show(),$("giftvoucher_container").down("dd.giftvoucher_credit").show(),$("giftvoucher_credit_ajaxload").hide()}var n="";t.notice&&(n+='<ul class="notice-msg"><li>'+t.notice+"</li></ul>"),""!=n&&$("gift_credit_message").update(n)}else{var o=getElement();o.show(),$("giftvoucher_container").down("dt.giftvoucher").show(),$("giftvoucher_container").down("dd.giftvoucher").show(),$("giftvoucher_container").down("dd.giftvoucher_credit").show(),$("giftvoucher_credit_ajaxload").hide()}"undefined"!=typeof save_shipping_method&&save_shipping_method(shipping_method_url,enable_update_payment,!0)}})}function showCartCreditInput(e){var t=Element.extend(e.parentNode.parentNode);e.checked?t.down("dd.giftvoucher_credit").show():t.down("dd.giftvoucher_credit").hide()}function showCartGiftCardInput(e){var t=Element.extend(e.parentNode.parentNode);e.checked?t.down("dd.giftvoucher").show():t.down("dd.giftvoucher").hide()}function showCreditInput(e){var t=Element.extend(e.parentNode);e.hide(),t.down(".credit_input").show(),t.down(".credit_input input").focus()}function enterUpdateCreditInput(e,t){13==t.keyCode&&updateCreditInput(e)}function updateCreditInput(e){var t=Element.extend(e.parentNode),o=$("giftvoucher_cache_url").innerHTML.stripTags().replace("/addgift","/creditamount");for(i=0;i<o.length;i++)"/"==o[o.length-1]&&(o=o.substr(0,o.length-1));o+="/amount/"+t.down("input").value,$("giftvoucher_container").down("dd.giftvoucher_credit").hide(),$("giftvoucher_credit_ajaxload").show(),new Ajax.Request(o,{method:"post",postBody:"",onComplete:function(e){if(e.responseText.isJSON()){var i=e.responseText.evalJSON();if(i.updatepayment)"undefined"!=typeof shippingMethod?shippingMethod.save():"undefined"!=typeof billing&&billing.save();else if(i.html){var o=$("giftvoucher_container");o.innerHTML=i.html,onLoadGiftvoucherForm()}else $("giftvoucher_container").down("dd.giftvoucher_credit").show(),$("giftvoucher_credit_ajaxload").hide(),t.hide(),t=Element.extend(t.parentNode),t.down(".using_credit").show();var n="";i.notice&&(n+='<ul class="notice-msg"><li>'+i.notice+"</li></ul>"),""!=n&&$("gift_credit_message").update(n)}else $("giftvoucher_container").down("dd.giftvoucher_credit").show(),$("giftvoucher_credit_ajaxload").hide();"undefined"!=typeof save_shipping_method&&save_shipping_method(shipping_method_url,enable_update_payment,!0)}})}function changeGiftcardVisible(e,t){var i="payment_form_"+e;[i+"_before",i,i+"_after"].each(function(e){element=$(e),element&&(element.style.display=t?"none":"",element.select("input","select","textarea","button").each(function(e){e.disabled=t}))})}function checkOutLoadGiftCard(e){if(!$("giftvoucher_container")){var t=getElement();t.insert({before:e.html}),$("p_method_free")&&($("p_method_free").up(1).innerHTML=$("p_method_free").up("dt").innerHTML,$("p_method_free").checked=!0)}}function getElement(){return void 0==$("checkout-payment-method-load").down("#checkout-payment-method-load")?$("checkout-payment-method-load"):$("checkout-payment-method-load").down("#checkout-payment-method-load")}